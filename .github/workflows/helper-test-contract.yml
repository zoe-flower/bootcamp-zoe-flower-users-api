# Code generated by dev-tool; DO NOT EDIT.
name: helper-test-contract
on:
  workflow_call:
    secrets:
      PACT_API_TOKEN:
        required: true

jobs:
  test-contract:
    runs-on: ubuntu-latest
    container:
      image: golang:1.22.0
    env:
      PACT_API_TOKEN: ${{ secrets.PACT_API_TOKEN }}
      SHA: ${{ github.sha }}
    steps:
      - uses: actions/checkout@v4.1.0
      - uses: "./.github/actions/pactinstall"
      - name: Run contract tests
        run: |-
          # go-kit runs "git config remote.origin.url" which fails if this isn't set
          git config --global --add safe.directory '*'
          
          export PATH=$PATH:/opt/pact/bin
          go clean -testcache
          if [ -d ./test/contracts/consumer ] || [ -d ./test/contracts/provider ]; then go test -mod=vendor ./test/contracts/...; fi
          mkdir -p test/contracts/consumer/pacts
      - uses: actions/upload-artifact@v3.1.3
        with:
          path: "./test/contracts/consumer/pacts/"
      - uses: actions/upload-artifact@v3.1.3
        with:
          path: "./test/contracts/consumer/logs"
      - uses: actions/upload-artifact@v3.1.3
        with:
          path: "./test/contracts/provider/logs"
