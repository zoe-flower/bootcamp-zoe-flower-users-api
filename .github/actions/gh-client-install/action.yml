# Code generated by dev-tool; DO NOT EDIT.
name: gh-client-install
description: "Install GH CLI client"
inputs:
  GH_CLI_VERSION:
    description: "GH CLI client Version to install"
    required: false
    default: 1.11.0
runs:
  using: composite
  steps:
  - name: Generate Checksum
    env:
      GH_CLI_VERSION: ${{ inputs.GH_CLI_VERSION }}
    run: |-
      # This file should not exist in the repo itself if it does this would overwrite.
      # This needs to be here as the hashFiles function only works in $GITHUB_WORKSPACE
      touch ghclientinstallcachefile.txt
      echo "${GH_CLI_VERSION}" > ghclientinstallcachefile.txt
    shell: bash
  - name: restore_cache
    uses: actions/cache/restore@v3.3.2
    with:
      path: "/tmp/cache"
      key: ghclient-${{ runner.os }}-${{ runner.arch }}-v1-${{ hashFiles('ghclientinstallcachefile.txt') }}
  - name: Setup
    env:
      GH_CLI_VERSION: ${{ inputs.GH_CLI_VERSION }}
    run: |-
      if [ -d "/tmp/cache" ]
      then
        cp /tmp/cache/ghclient/${GH_CLI_VERSION}/ghclient /usr/local/bin/gh
      else
        mkdir -p /tmp/cache/ghclient/${GH_CLI_VERSION}
        wget https://github.com/cli/cli/releases/download/v${GH_CLI_VERSION}/gh_${GH_CLI_VERSION}_linux_amd64.tar.gz -O /tmp/ghcli.tar.gz
        tar -xf /tmp/ghcli.tar.gz -C /tmp/
        mv /tmp/gh_${GH_CLI_VERSION}_linux_amd64/bin/gh /usr/local/bin/gh
        cp /usr/local/bin/gh /tmp/cache/ghclient/${GH_CLI_VERSION}/ghclient
      fi
    shell: bash
  - name: save_cache
    uses: actions/cache/save@v3.3.2
    with:
      path: "/tmp/cache"
      key: ghclient-${{ runner.os }}-${{ runner.arch }}-v1-${{ hashFiles('ghclientinstallcachefile.txt') }}
  - name: Cleanup Checksum
    run: |-
      rm ghclientinstallcachefile.txt
    shell: bash
