# Code generated by dev-tool; DO NOT EDIT.
name: pactinstall
description: "Job for installing Pact binary"
inputs:
  PACT_VERSION:
    description: "Version of pact to install"
    required: false
    default: 1.88.80
runs:
  using: composite
  steps:
  - name: Generate Checksum
    env:
      PACT_VERSION: ${{ inputs.PACT_VERSION }}
    run: |-
      # This file should not exist in the repo itself if it does this would overwrite.
      # This needs to be here as the hashFiles function only works in $GITHUB_WORKSPACE
      touch pactinstallcachefile.txt
      echo "$PACT_VERSION" > pactinstallcachefile.txt
    shell: bash
  - name: restore_cache
    uses: actions/cache/restore@v3.3.2
    with:
      path: "/tmp/cache"
      key: pactinstall-${{ runner.os }}-${{ runner.arch }}-v2-${{ hashFiles('pactinstallcachefile.txt') }}
  - name: Install
    env:
      PACT_VERSION: ${{ inputs.PACT_VERSION }}
    run: |-
      cd /opt
      if [ -d "/tmp/cache" ]
      then
          echo "using cache";
          mkdir -p /opt/pact/bin
          cp -r /tmp/cache/pact/$PACT_VERSION/. /opt/pact/.
      else
          echo "pulling from source";
          curl -LO https://github.com/pact-foundation/pact-ruby-standalone/releases/download/v$PACT_VERSION/pact-$PACT_VERSION-linux-x86_64.tar.gz
          tar xzf pact-$PACT_VERSION-linux-x86_64.tar.gz
          mkdir -p /tmp/cache/pact/$PACT_VERSION
          cp -r pact/. /tmp/cache/pact/$PACT_VERSION/.
      fi
    shell: bash
  - name: save_cache
    uses: actions/cache/save@v3.3.2
    with:
      path: "/tmp/cache"
      key: pactinstall-${{ runner.os }}-${{ runner.arch }}-v2-${{ hashFiles('pactinstallcachefile.txt') }}
  - name: Cleanup Checksum
    run: |-
      rm pactinstallcachefile.txt
    shell: bash
